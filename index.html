<!doctype html>
<head>
	<title>Dot: Interactive dot plot for genome-genome alignments</title>
	<style>
		body { 
			margin: 0; 
			font-family: Arial;
		}
		svg, canvas {
			position: absolute;
			top: 0;
			left: 0;
		}
		h2 {
			padding: 2vmin 2vmin 2vmin 2vmin;
		}
		rect { fill: transparent; }
	</style>
	<script src="js/d3.v4.min.js"></script>
	<script src="js/ramda.min.js"></script>
	<script src="js/MultiSegmentScale.js"></script>
	<script src="js/InputPanel.js"></script>
	<script src="js/Dot.js"></script>
</head>
<body>

<h2>Dot: Interactive dot plot for genome-genome alignments</h2>
<div id="inputPanel"></div>



<script type='text/javascript'>

/* SET UP ENV */

var w = window,
	d = document,
	e = d.documentElement,
	g = d.getElementsByTagName('body')[0];



var _map = {	width: (w.innerWidth || e.clientWidth || g.clientWidth)*0.80,
				height: (w.innerHeight || e.clientHeight || g.clientHeight)*0.80,
				x: 'ref',
				y: 'query'
			};

var _app_area = 
	d3.select('body')
		.append('div')
		.attr("id","plotting-area")
		.style("position","relative");



/* PREPARE DATA and SCALES */

var _scales = {x: null, y: null};


var _dot;


/* Set up the Dot app */

_dot = new DotApp(_app_area, {height: _map.height, width: _map.width});


/* Process inputs */

function setAlignmentData(source) {
	// Type these columns as numbers:
	var numericColumns = ["ref_length", "ref_start", "ref_end", "query_length", "query_start", "query_end", "alignment_length"];
	d3.csv(source, function(error,rows) {
		if (error) throw error;
		rows.map(function(d) {
			numericColumns.map(function(key) {return d[key] = Number(d[key]) });
		});
		_dot.setData(rows);
	});
}

var inputSpec = {
	alignments: {name: "alignments", required: true, callback: setAlignmentData},
	annotations: {name: "annotations", required: true},
};

var _input_area = d3.select("#inputPanel");

var _input_panel = new InputPanel({
	element: _input_area,
	spec: inputSpec,
});



// TESTS:
// https://dl.dnanex.us/F/D/g650fKffZYjFx1b2zfKVJB389V0F7fkvZpg0QpJ6/Arabidopsis_thaliana_MHAP_assembly.oriented_coords.csv
// https://dl.dnanex.us/F/D/F8jj7q411fqGXvPjVBvFgpJFyvjVYBBZj3v68p55/Saccharomyces_cerevisiae_MHAP_assembly.oriented_coords.csv




	</script>
</body>


